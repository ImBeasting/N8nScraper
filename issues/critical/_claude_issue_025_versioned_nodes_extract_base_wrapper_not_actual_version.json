{
  "issue_id": "_claude_issue_025",
  "title": "PATTERN: Versioned nodes extract from base wrapper instead of actual version implementation - affects Notion, Airtable, Discord, and more",
  "severity": "critical",
  "status": "in_progress",
  "priority": 1,
  "metadata": {
    "created_at": "2025-11-07T00:45:00Z",
    "created_by": "claude_code",
    "affected_nodes": "Notion (4 properties, should be 100+), Airtable (6 properties, should be 50+), Discord (3 properties, should be 30+), and potentially 20-30 other versioned nodes",
    "validation_session": "comprehensive_cross_reference_2025-11-07",
    "related_issues": "_claude_issue_020 (versioned node base description - may be related)"
  },
  "description": {
    "problem": "Versioned nodes using VersionedNodeType class extract properties from the base wrapper file (which only has minimal baseDescription) instead of from the actual version implementation files (v1/v2/V1/V2) which contain the full property definitions. Results in 95%+ property loss.",
    "impact": "CRITICAL - Affects major popular nodes like Notion, Airtable, Discord. Estimated 20-30 versioned nodes affected. Each node loses 90-95% of properties, making documentation completely unusable. High-profile nodes appear broken in documentation.",
    "root_cause": "Extractor processes NodeName.node.ts which is a VersionedNodeType wrapper that only contains:\n1. baseDescription (displayName, name, icon, group, subtitle, description, defaultVersion)\n2. nodeVersions dictionary that instantiates actual version classes\n\nThe actual properties are in version-specific files:\n- v1/NotionV1.node.ts\n- v2/NotionV2.node.ts\n\nExtractor Pattern:\n```typescript\n// Notion.node.ts - Base wrapper (THIS is what gets extracted \u274c)\nexport class Notion extends VersionedNodeType {\n  constructor() {\n    const baseDescription: INodeTypeBaseDescription = {\n      displayName: 'Notion',\n      // ... minimal metadata only\n      defaultVersion: 2.2,\n    };\n    \n    const nodeVersions = {\n      1: new NotionV1(baseDescription),  // \u2190 Actual properties here\n      2: new NotionV2(baseDescription),  // \u2190 Actual properties here\n    };\n    \n    super(nodeVersions, baseDescription);\n  }\n}\n\n// v2/NotionV2.node.ts - Actual implementation (NOT extracted \u274c)\nexport class NotionV2 implements INodeType {\n  description: INodeTypeDescription = {\n    ...baseDescription,\n    properties: [\n      // 100+ properties here \u2190 THIS should be extracted\n    ]\n  }\n}\n```\n\nExtractor needs to:\n1. Detect VersionedNodeType pattern\n2. Determine defaultVersion\n3. Extract from version-specific file instead of base wrapper",
    "evidence": [
      "CASE 1: Notion",
      "  Source: n8n/packages/nodes-base/nodes/Notion/Notion.node.ts",
      "    - VersionedNodeType wrapper with baseDescription only",
      "    - defaultVersion: 2.2",
      "    - nodeVersions: { 1: NotionV1, 2: NotionV2, 2.1: NotionV2, 2.2: NotionV2 }",
      "",
      "  Actual properties location: n8n/packages/nodes-base/nodes/Notion/v2/NotionV2.node.ts",
      "    - Estimated 100+ properties for database, page, user resources",
      "",
      "  Extracted: extracted_docs/notion_data.json",
      "    - properties.length = 4",
      "    - version = [\"2\", \"2.1\", \"2.2\"]",
      "    - Only has baseDescription metadata, no actual properties",
      "",
      "  Loss: 96+ properties (96% missing)",
      "",
      "CASE 2: Airtable",
      "  Source: n8n/packages/nodes-base/nodes/Airtable/Airtable.node.ts",
      "    - VersionedNodeType wrapper",
      "    - defaultVersion: 2",
      "    - nodeVersions: { 1: AirtableV1, 2: AirtableV2 }",
      "",
      "  Actual properties: n8n/packages/nodes-base/nodes/Airtable/v2/AirtableV2.node.ts",
      "    - Estimated 50+ properties for table, record operations",
      "",
      "  Extracted: extracted_docs/airtable_data.json",
      "    - properties.length = 6",
      "    - operations.length = 8",
      "",
      "  Loss: 44+ properties (88% missing)",
      "",
      "CASE 3: Discord",
      "  Source: n8n/packages/nodes-base/nodes/Discord/Discord.node.ts",
      "    - VersionedNodeType wrapper",
      "",
      "  Extracted: extracted_docs/discord_data.json",
      "    - properties.length = 3",
      "    - operations.length = 0",
      "",
      "  Loss: Estimated 27+ properties (90% missing)",
      "",
      "PATTERN IDENTIFICATION:",
      "  $ grep -l 'extends VersionedNodeType' n8n/packages/nodes-base/nodes/*/*.node.ts | wc -l",
      "  Estimated: 20-30 nodes",
      "",
      "  Common patterns:",
      "    - Nodes with v1/, v2/, v3/ subdirectories",
      "    - Nodes with V1/, V2/, V3/ subdirectories",
      "    - Base file extends VersionedNodeType",
      "    - Base file has minimal baseDescription",
      "    - Version files have actual properties",
      "",
      "VERIFICATION:",
      "  $ jq '.properties | length' extracted_docs/notion_data.json",
      "  Output: 4",
      "",
      "  $ jq '.node_info.version' extracted_docs/notion_data.json",
      "  Output: [\"2\", \"2.1\", \"2.2\"]",
      "",
      "  $ find n8n/packages/nodes-base/nodes/Notion/v2 -name '*.ts' -type f",
      "  Output: NotionV2.node.ts (contains actual properties)"
    ],
    "fix_approach": "Implement versioned node detection and version-specific extraction:\n\n1. Detect VersionedNodeType pattern:\n   - In extract_info(), check if main file contains 'extends VersionedNodeType'\n   - If yes, this is a versioned node wrapper\n\n2. Extract defaultVersion from baseDescription:\n   - Parse: defaultVersion: 2.2\n   - This tells us which version to extract\n\n3. Map version to version directory:\n   - defaultVersion: 2.2 \u2192 Try these paths:\n     a) v2/NodeNameV2.node.ts\n     b) V2/NodeNameV2.node.ts\n     c) v2.2/NodeNameV2_2.node.ts\n     d) Look for nodeVersions dictionary to find class name\n\n4. Extract from version-specific file:\n   - Read version file instead of base wrapper\n   - Extract properties, operations, methods from version file\n   - Merge baseDescription metadata (icon, group, subtitle) with version properties\n\n5. Handle version inheritance:\n   - Version class receives baseDescription in constructor\n   - Properties should be: {...baseDescription, properties: [...], methods: {...}}\n   - Extractor should merge both\n\n6. Implementation steps:\n   a) Add detect_versioned_node() method\n   b) Add get_default_version() method\n   c) Add resolve_version_file() method\n   d) Modify extract_info() to check for versioned nodes first\n   e) If versioned, extract from version file, not base\n\n7. Test cases:\n   - python3 n8n_node_extractor.py extract Notion\n   - Verify: jq '.properties | length' shows 100+ not 4\n   - Verify: All Notion resources (database, page, user) present\n   - Test: Airtable, Discord, and 5 other versioned nodes\n\n8. Edge cases:\n   - Multiple versions (1, 2, 2.1, 2.2) - extract defaultVersion only\n   - Different version naming (v2 vs V2) - try both\n   - Version class name may differ from file name\n\n9. Success criteria:\n   - Notion: 4 \u2192 100+ properties\n   - Airtable: 6 \u2192 50+ properties\n   - Discord: 3 \u2192 30+ properties\n   - All versioned nodes show full property sets\n\nImplementation priority: CRITICAL - Affects high-profile popular nodes (Notion, Airtable are heavily used)"
  },
  "ownership": {
    "assigned_to": "claude_code",
    "locked_by": null,
    "lock_acquired_at": null,
    "lock_expires_at": null,
    "claimed_at": "2025-11-07T19:43:29.941515Z"
  },
  "audit_note": "Status changed from \"resolved\" to \"in_progress\" - works for some nodes (Notion) but fails for others (Airtable, Discord)"
}