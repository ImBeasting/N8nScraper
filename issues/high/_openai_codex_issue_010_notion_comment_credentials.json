{
  "issue_id": "_openai_codex_issue_010",
  "title": "Notion credentials parsed from commented code – phantom OAuth2 requirement and garbage displayOptions",
  "severity": "high",
  "status": "new",
  "priority": 2,
  "metadata": {
    "created_at": "2025-11-12T01:45:00Z",
    "created_by": "openai_codex",
    "affected_nodes": "Notion v2 (likely any node with commented credential blocks)"
  },
  "description": {
    "problem": "The extractor is treating commented-out credential definitions and displayOptions as real data. Notion now documents two credentials (`notionApi`, `notionOAuth2Api`) even though OAuth2 support is entirely commented out upstream, and the displayOptions arrays are literal comment strings (`\"// \\t\\t\\t'apiKey\"`).",
    "impact": "HIGH – Documentation and downstream tooling think Notion requires an OAuth2 credential plus weird `authentication=['//…']` filters. Users following the JSON will request the wrong credential and the UI cannot apply conditional logic because the values are `//` strings instead of `apiKey`/`oAuth2`.",
    "root_cause": "In `n8n/packages/nodes-base/nodes/Notion/v2/VersionDescription.ts` lines 32-67 the OAuth2 credential and authentication selector are fully commented. The extractor still runs its regex over the commented text, so it emits every `'...'` token it finds (including comment markers) as live values. Because comments precede the real credential (which is also partially commented), even the valid API key entry inherits the garbage strings.",
    "evidence": [
      "Source snippet (VersionDescription.ts):\n```ts\ncredentials: [\n  {\n    name: 'notionApi',\n    required: true,\n    // displayOptions: {\n    //   show: { authentication: ['apiKey'] }\n    // },\n  },\n  // {\n  //   name: 'notionOAuth2Api',\n  //   required: true,\n  //   displayOptions: {\n  //     show: { authentication: ['oAuth2'] }\n  //   },\n  // },\n],\n```\nThe entire OAuth2 block is prefixed with `//`.",
      "Extracted credentials: `jq '.credentials' extracted_docs/notion_data.json` →\n```json\n[\n  {\n    \"name\": \"notionApi\",\n    \"required\": true,\n    \"displayOptions\": {\n      \"show\": { \"authentication\": [\"// \\t\\t\\t'apiKey\", \"//\"] }\n    }\n  },\n  {\n    \"name\": \"notionOAuth2Api\",\n    \"required\": true,\n    \"displayOptions\": {\n      \"show\": { \"authentication\": [\"// \\t\\t\\t\\t'oAuth2\", \"//\"] }\n    }\n  }\n]\n```\nNone of those string literals exist in the source code – they are the comment text itself.",
      "The first property in `extracted_docs/notion_data.json` is already the notice, confirming the authentication selector remains commented and should not exist, so the second credential is entirely fabricated."
    ],
    "fix_approach": "Strip TypeScript/JS comments before running the existing regex-based extraction:\n1. Preprocess each file with a comment remover (or feed the content through the TypeScript compiler API) so `// ...` and `/* ... */` blocks are removed, preventing their string literals from being parsed as real data.\n2. Re-run the extractor for Notion – `node_info.authentication` should only contain `notionApi` with a proper `authentication: ['apiKey']` filter, and there should be no phantom `notionOAuth2Api` entry.\n3. Add a regression in `validate_extraction.py` that flags any displayOptions values starting with `//` or containing whitespace+comment characters to catch future comment leaks."
  },
  "ownership": {
    "assigned_to": null,
    "locked_by": null,
    "lock_acquired_at": null,
    "lock_expires_at": null,
    "claimed_at": null
  }
}
