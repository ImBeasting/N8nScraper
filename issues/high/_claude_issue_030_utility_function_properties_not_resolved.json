{
  "issue_id": "_claude_issue_030",
  "title": "Utility function calls in spread operators not resolved",
  "severity": "high",
  "status": "new",
  "priority": 3,
  "metadata": {
    "created_at": "2025-11-11T00:00:00Z",
    "created_by": "claude_code",
    "affected_nodes": "Slack (getSendAndWaitProperties missing 10-20 properties), HTTP Request, potentially 15-30 nodes using utility functions"
  },
  "description": {
    "problem": "Spread operators containing function calls (...functionName(args)) are not resolved, causing complete loss of properties returned by utility functions",
    "impact": "HIGH - Slack node extracted only 110 properties vs ~275 expected (40% coverage). Missing send-and-wait specific properties: timeout duration, webhook URL, response handling options, subject field. HTTP Request and other complex nodes likely affected by similar utility function patterns.",
    "root_cause": "The spread operator resolution in TypeScriptParser handles:\n1. Simple spreads: ...arrayName ✓\n2. Property access spreads: ...module.arrayName ✓\n3. Bare identifier spreads: identifier ✓\n\nIt does NOT handle:\n1. Function call spreads: ...functionName(args)\n2. Method chain spreads: ...obj.method().filter()\n3. Conditional spreads: ...(condition ? arr1 : arr2)\n\nUtility functions like getSendAndWaitProperties() generate property arrays dynamically but are not evaluated.",
    "evidence": [
      "Slack SlackV2.node.ts source (lines 148-166):",
      "  ...getSendAndWaitProperties([",
      "    { ...sendToSelector, default: 'user' },",
      "    {",
      "      ...channelRLC,",
      "      displayOptions: { show: { select: ['channel'] } },",
      "    },",
      "    {",
      "      ...userRLC,",
      "      displayOptions: { show: { select: ['user'] } },",
      "    },",
      "  ]).filter((p) => p.name !== 'subject'),",
      "",
      "getSendAndWaitProperties is imported from:",
      "  import { getSendAndWaitProperties } from '@utils/sendAndWait'",
      "",
      "This function returns ~10-20 properties for send-and-wait functionality:",
      "  - timeout settings",
      "  - webhook configuration",
      "  - response handling",
      "  - subject field (filtered out)",
      "",
      "Slack property extraction results:",
      "  jq '.properties | length' extracted_docs/slack_data.json",
      "  Result: 110 (Expected: ~275 with utility function properties)",
      "",
      "Property coverage by resource:",
      "  Channel: 36/36 = 100% ✓",
      "  File: 9/21 = 43%",
      "  Message: 26/82 = 32%",
      "  User: 5/23 = 22%",
      "  UserGroup: 11/25 = 44%",
      "",
      "The low coverage in most resources suggests missing properties from function calls",
      "",
      "Similar patterns likely in:",
      "  - HTTP Request (utility functions for auth, request building)",
      "  - GoogleSheets (helper functions for ranges, formatting)",
      "  - Other complex multi-operation nodes"
    ],
    "fix_approach": "1. Add function call detection in _resolve_spreads():\n   # Pattern: ...functionName(args)\n   func_call_pattern = r'\\.\\.\\.([\\w]+)\\((.*)\\)'\n   func_matches = re.findall(func_call_pattern, spread_line)\n\n2. For detected function calls, implement resolution strategies:\n\n   Strategy A: Known utility function mapping (quick win):\n   KNOWN_UTILITY_FUNCTIONS = {\n       'getSendAndWaitProperties': 'extract_send_and_wait_props',\n       'getCommonProperties': 'extract_common_props',\n       'getAuthProperties': 'extract_auth_props',\n   }\n   # Map to custom extraction functions\n\n   Strategy B: Try to locate and parse function source:\n   - Parse import statement to find function location\n   - Read function source file\n   - Extract return statement\n   - Parse returned array\n   - Handle simple cases (return [...array])\n\n   Strategy C: Fallback - mark as unresolved:\n   properties.append({\n       '_unresolved_spread': f'...{func_name}(...)',\n       '_note': 'Function call not resolved - properties missing',\n       '_estimated_count': 'unknown'\n   })\n\n3. Implement extract_send_and_wait_props():\n   - Common properties for send-and-wait pattern\n   - Can be hardcoded based on n8n utils analysis\n   - Properties: timeout, webhookSuffix, responseProperty, subject, etc.\n\n4. Test on:\n   - Slack (should see +10-20 properties for send-and-wait)\n   - HTTP Request (check for utility function usage)\n   - Property count validation across affected nodes\n\n5. Validation:\n   python3 n8n_node_extractor.py extract Slack\n   jq '.properties | length' extracted_docs/slack_data.json\n   Expected: 120-130 (up from 110)\n   \n   Check for send-and-wait properties:\n   jq '.properties[] | select(.name | contains(\"timeout\") or contains(\"webhook\"))' extracted_docs/slack_data.json\n   Expected: Multiple properties (currently none)"
  },
  "ownership": {
    "assigned_to": null,
    "locked_by": null,
    "lock_acquired_at": null,
    "lock_expires_at": null,
    "claimed_at": null
  }
}